<div class="audit-container p-3">
    <!-- User info section -->
    <div class="user-info" ng-if="currentUser">
        <p>Welcome, {{currentUser.username}}</p>
        <button ng-click="logout()">Logout</button>
    </div>


    <div class="row mb-4">
        <div class="col-12">
            <div class="stats-bar">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="progress-info">
                        <span class="badge bg-success me-2">Completed: {{completedCount}}</span>
                        <span class="badge bg-warning me-2">Pending: {{pendingCount}}</span>
                        <span class="badge bg-info">Total: {{totalRecords}}</span>
                    </div>
                    <span class="text-muted">Time Remaining: {{timeRemaining}}</span>
                </div>
                <div class="progress">
                    <div class="progress-bar" 
                         role="progressbar"
                         ng-style="{'width': completionPercentage + '%'}"
                         aria-valuenow="{{completionPercentage}}"
                         aria-valuemin="0"
                         aria-valuemax="100">{{completionPercentage}}%</div>
                </div>
            </div>
        </div>
    </div>

    <div class="table-wrapper">
        <table class="table table-bordered table-hover records-table">
            <thead class="table-light">
                <tr>
                    <th class="col-website">Website</th>
                    <th class="col-brand">Brand</th>
                    <th class="col-match">Brand Match</th>
                    <th class="col-dtc">DTC Status</th>
                    <th class="col-risk">Risk Status</th>
                    <th class="col-redirects">Redirects</th>
                    <th class="col-url">Redirect URL</th>
                    <th class="col-reason">Risk Reason</th>
                    <th class="col-status">Status</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="record in currentRecords" 
                    ng-class="{'saved': record.saveStatus === 'Saved successfully'}">
                    <td class="website-cell" title="{{record.website_name}}">
                        {{record.website_name}}
                    </td>
                    <td>{{record.brand_name}}</td>
                    <td>
                        <select ng-model="record.brand_matches_website" 
                                ng-change="autoSave(record)">
                            <option value="">Select...</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </td>
                    <td>
                        <select ng-model="record.dtc_status" 
                                ng-change="autoSave(record)">
                            <option value="">Select...</option>
                            <option value="DTC">DTC</option>
                            <option value="Not DTC">Not DTC</option>
                        </select>
                    </td>
                    <td>
                        <select ng-model="record.risk_status" 
                                ng-change="updateRiskReason(record)">
                            <option value="">Select...</option>
                            <option value="Risky">Risky</option>
                            <option value="Not Risky">Not Risky</option>
                        </select>
                    </td>
                    <td>
                        <select ng-model="record.redirects" 
                                ng-change="autoSave(record)">
                            <option value="">Select...</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </td>
                    <td>
                        <textarea ng-model="record.redirected_url"
                                ng-change="autoSave(record)"
                                placeholder="Enter redirect URL..."
                                rows="2"></textarea>
                    </td>
                    <td>
                        <textarea ng-if="record.risk_status === 'Risky'"
                                ng-model="record.risk_reason"
                                ng-change="autoSave(record)"
                                placeholder="Enter risk reason..."
                                rows="2"></textarea>
                    </td>
                    <td class="status-cell">
                        <span class="save-status" ng-if="record.saveStatus"></span>
                            {{record.saveStatus}}
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <nav aria-label="Page navigation" class="mt-3">
        <ul class="pagination justify-content-center">
            <li class="page-item" ng-class="{disabled: currentPage === 1}">
                <button class="page-link" ng-click="previousPage()">← Previous</button>
            </li>
            <li class="page-item disabled">
                <span class="page-link">Page {{currentPage}} of {{totalPages}}</span>
            </li>
            <li class="page-item" ng-class="{disabled: currentPage === totalPages}">
                <button class="page-link" ng-click="nextPage()">Next →</button>
            </li>
        </ul>
    </nav>
</div>
